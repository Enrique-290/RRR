<!doctype html>
<html lang="es">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>DINAMITA GYM POS</title>
<style>
:root{
  --rojo:#c91313; --negro:#0f1115; --gris:#171a21; --claro:#f3f4f6; --borde:#e5e7eb;
  --txt:#111827; --ok:#10b981;
}
*{box-sizing:border-box}
body{margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,Inter,Ubuntu,Arial,sans-serif;background:#fff;color:var(--txt)}
header{background:var(--rojo);color:#fff;padding:14px 16px;display:flex;gap:16px;align-items:center;position:sticky;top:0;z-index:5}
header h1{font-size:18px;margin:0;font-weight:800;letter-spacing:.5px}
#wrap{display:flex;min-height:100vh}
aside{width:250px;background:var(--negro);color:#fff;position:sticky;top:0;height:100vh;overflow:auto}
aside .brand{display:flex;gap:10px;align-items:center;padding:16px 14px;border-bottom:1px solid #1f232c}
aside .brand .dot{background:#ef4444;width:32px;height:32px;border-radius:10px;display:grid;place-items:center;font-weight:700}
nav a{display:flex;gap:10px;align-items:center;padding:12px 14px;color:#cbd5e1;text-decoration:none;border-left:3px solid transparent}
nav a.active{background:#161a22;color:#fff;border-left-color:#ef4444}
main{flex:1;background:#fff;min-width:0}
.container{max-width:1100px;margin:20px auto;padding:0 16px}
.card{background:#fff;border:1px solid var(--borde);border-radius:12px;padding:16px;box-shadow:0 1px 0 rgba(0,0,0,.02);margin-bottom:16px}
.row{display:grid;grid-template-columns:repeat(12,1fr);gap:12px}
.col-4{grid-column:span 4} .col-6{grid-column:span 6} .col-8{grid-column:span 8} .col-12{grid-column:span 12}
input,select,button,textarea{font:inherit}
input[type=text],input[type=number],input[type=file],select,textarea{
  width:100%;padding:10px;border:1px solid var(--borde);border-radius:10px;background:#fff
}
.btn{border:0;border-radius:14px;padding:10px 14px;cursor:pointer;font-weight:700}
.btn-red{background:var(--rojo);color:#fff} .btn-dark{background:#111827;color:#fff}
.btn-ghost{background:#fff;border:1px solid var(--borde);}
.actions{display:flex;gap:8px;flex-wrap:wrap}
.small{font-size:12px;color:#6b7280}
.table{width:100%;border-collapse:collapse}
.table th,.table td{padding:10px;border-bottom:1px solid var(--borde);text-align:left}
.badge{padding:3px 8px;border-radius:999px;font-size:12px;background:#111827;color:#fff}
footer.fixed{position:sticky;bottom:0;background:#fff;border-top:1px solid var(--borde);padding:10px;display:flex;justify-content:center;gap:12px}
/* Ticket 58mm */
.ticket{width:260px;margin:0 auto;padding:14px;background:#fff;border:1px dashed #ddd;border-radius:12px}
.ticket h3{text-align:center;margin:6px 0 12px 0}
.ticket pre{font-family:ui-monospace, SFMono-Regular, Menlo, monospace;white-space:pre-wrap;font-size:14px}
@media print{
  header,aside,footer.fixed,.no-print{display:none!important}
  main{padding:0;margin:0}
  .ticket{border:0}
}
</style>
</head>
<body>
<header>
  <h1>DINAMITA GYM POS</h1>
  <span class="small">v4 (localStorage + export)</span>
</header>
<div id="wrap">
  <aside>
    <div class="brand"><div class="dot">DG</div><div><b>DINAMITA</b><div class="small">GYM POS</div></div></div>
    <nav id="menu">
      <a href="#/dashboard" data-route="dashboard" class="active">üè† Dashboard</a>
      <a href="#/ventas" data-route="ventas">üõí Ventas</a>
      <a href="#/inventario" data-route="inventario">üì¶ Inventario</a>
      <a href="#/clientes" data-route="clientes">üë§ Clientes</a>
      <a href="#/historial" data-route="historial">üìú Historial</a>
      <a href="#/ticket" data-route="ticket">üßæ Ticket 58mm</a>
      <a href="#/config" data-route="config">‚öôÔ∏è Configuraci√≥n</a>
    </nav>
  </aside>
  <main>
    <div class="container" id="view"></div>
    <footer class="fixed no-print">
      <button class="btn btn-dark" id="btnCsv">üíº Exportar ventas (CSV)</button>
      <button class="btn btn-red" id="btnPdf">üßæ Exportar ventas (PDF)</button>
    </footer>
  </main>
</div>

<script>
/* ====== STORAGE HELPERS ====== */
const LS = {
  get(k, def){ try{ return JSON.parse(localStorage.getItem(k) ?? JSON.stringify(def)); }catch(e){ return def; } },
  set(k, v){ localStorage.setItem(k, JSON.stringify(v)); }
};
/* ====== DATA MODELS ====== */
const state = {
  config: LS.get('config', {negocio:'DINAMITA GYM POS', mensaje:'¬°Gracias por tu compra!', iva:0, logo:null}),
  inventario: LS.get('inventario', [
    {sku:'555255', nombre:'AGUA BONAFONT 2LT', categoria:'AGUAS', precio:20, costo:10, stock:100},
    {sku:'66565565', nombre:'AGUA BONAFON 1 LT', categoria:'AGUAS', precio:14, costo:8, stock:100},
    {sku:'56556866966', nombre:'GATORADE 1 LT', categoria:'BEBIDAS HIDRATANTES', precio:26, costo:15, stock:100},
    {sku:'8555885', nombre:'CAFE AMERICANO', categoria:'CAFETERIA', precio:25, costo:5, stock:100}
  ]),
  clientes: LS.get('clientes', [{nombre:'Venta al p√∫blico', tel:'', email:'', cert:false, solo:false}]),
  ventas: LS.get('ventas', []),
  carrito: []
};
function saveAll(){
  LS.set('config', state.config);
  LS.set('inventario', state.inventario);
  LS.set('clientes', state.clientes);
  LS.set('ventas', state.ventas);
}
/* ====== UTILS ====== */
const $ = sel => document.querySelector(sel);
const $$ = sel => Array.from(document.querySelectorAll(sel));
const fmt = n => n.toLocaleString('es-MX',{style:'currency',currency:'MXN'});
const nowStr = () => new Date().toLocaleString('es-MX',{hour12:false});
const genFolio = () => 'T' + Math.random().toString(36).slice(2,7).toUpperCase();
/* ====== RENDER ====== */
const routes = {
  dashboard(){
    const totalDia = state.ventas.filter(v=>new Date(v.fecha).toDateString()===new Date().toDateString())
      .reduce((a,b)=>a+b.total,0);
    const productos = state.inventario.reduce((a,b)=>a+b.stock,0);
    const ganancia = state.ventas.reduce((a,v)=>a+(v.total - v.items.reduce((s,i)=>s + i.costo*i.cant,0)),0);
    $('#view').innerHTML = `
      <div class="row">
        <div class="col-6">
          <div class="card">
            <div class="small">Ventas de hoy</div>
            <h2>${fmt(totalDia)} <span class="badge">‚óè</span></h2>
          </div>
        </div>
        <div class="col-6"><div class="card"><div class="small">Tickets emitidos</div><h2>${state.ventas.length}</h2></div></div>
        <div class="col-6"><div class="card"><div class="small">Productos en stock</div><h2>${productos}</h2></div></div>
        <div class="col-6"><div class="card"><div class="small">Ganancia estimada</div><h2>${fmt(ganancia)}</h2></div></div>
      </div>
      <div class="card"><b>Resumen</b><div class="small">Bienvenido a <b>${state.config.negocio}</b>. Usa el men√∫ lateral para navegar.</div></div>`;
  },
  ventas(){
    const opts = state.inventario.map(p=>`${p.nombre} ¬∑ ${fmt(p.precio)}`).join(' ¬∑ ');
    $('#view').innerHTML = `
      <div class="card">
        <b>Nueva venta</b>
        <div class="row" style="margin-top:10px">
          <div class="col-8"><input id="buscador" placeholder="Buscar producto..."><div class="small">${opts}</div></div>
          <div class="col-4"><button id="addBtn" class="btn btn-red" style="width:100%">Agregar ‚ñ∂</button></div>
        </div>
        <div id="sugerencias" class="small" style="margin:6px 0"></div>
        <table class="table" id="tblCarrito"><thead><tr><th>Producto</th><th>Cant</th><th>Precio</th><th>Total</th><th></th></tr></thead><tbody></tbody></table>
        <div class="row">
          <div class="col-6">
            <label class="small">Cliente</label>
            <select id="selCliente">${state.clientes.map((c,i)=>`<option value="${i}">${c.nombre}</option>`).join('')}</select>
          </div>
          <div class="col-6">
            <label class="small">Notas del ticket</label>
            <input id="nota" value="${state.config.mensaje}">
          </div>
        </div>
        <div class="actions" style="margin-top:12px">
          <div id="totales" class="small"></div>
          <button id="confirmar" class="btn btn-red">Confirmar venta</button>
        </div>
      </div>`;
    $('#selCliente').value = "0"; // Venta al p√∫blico por defecto
    // Eventos
    const busc = $('#buscador');
    const sug = $('#sugerencias');
    function renderCarrito(){
      const tb = $('#tblCarrito tbody'); tb.innerHTML='';
      let sub=0;
      state.carrito.forEach((it,idx)=>{
        const tot = it.precio*it.cant; sub+=tot;
        const tr = document.createElement('tr');
        tr.innerHTML = `<td>${it.nombre}</td>
          <td><input type="number" min="1" value="${it.cant}" style="width:70px"></td>
          <td>${fmt(it.precio)}</td><td>${fmt(tot)}</td>
          <td><button class="btn btn-ghost">‚úñ</button></td>`;
        tr.querySelector('input').oninput = e=>{ it.cant = Math.max(1, +e.target.value||1); renderCarrito(); };
        tr.querySelector('button').onclick = ()=>{ state.carrito.splice(idx,1); renderCarrito(); };
        tb.appendChild(tr);
      });
      const iva = +(state.config.iva||0)/100 * sub;
      $('#totales').textContent = `SUBTOTAL ${fmt(sub)} ¬∑ IVA (${state.config.iva||0}%) ${fmt(iva)} ¬∑ TOTAL ${fmt(sub+iva)}`;
    }
    function renderSugs(){
      const q = busc.value.trim().toLowerCase();
      if(!q){ sug.innerHTML=''; return; }
      const list = state.inventario.filter(p=>p.nombre.toLowerCase().includes(q)).slice(0,8);
      sug.innerHTML = list.map(p=>`<button data-sku="${p.sku}" class="btn btn-ghost" style="margin:4px 6px 0 0">${p.nombre} ¬∑ ${fmt(p.precio)}</button>`).join('');
      sug.querySelectorAll('button').forEach(b=>b.onclick=()=>addSku(b.dataset.sku));
    }
    function addSku(sku){
      const p = state.inventario.find(x=>x.sku===sku);
      if(!p){ alert('No encontrado'); return; }
      const ex = state.carrito.find(x=>x.sku===sku);
      if(ex) ex.cant++; else state.carrito.push({sku:p.sku,nombre:p.nombre,precio:p.precio,costo:p.costo,cant:1});
      renderCarrito();
    }
    busc.oninput = renderSugs;
    $('#addBtn').onclick = renderSugs;
    $('#confirmar').onclick = ()=>{
      if(!state.carrito.length) return alert('Carrito vac√≠o');
      // Control de stock
      for(const it of state.carrito){
        const prod = state.inventario.find(p=>p.sku===it.sku);
        if(!prod || prod.stock < it.cant) return alert('Sin stock para ' + it.nombre);
      }
      // Descontar stock
      for(const it of state.carrito){
        const prod = state.inventario.find(p=>p.sku===it.sku);
        prod.stock -= it.cant;
      }
      const sub = state.carrito.reduce((a,i)=>a+i.precio*i.cant,0);
      const iva = +(state.config.iva||0)/100 * sub;
      const venta = {
        folio: genFolio(), fecha: new Date().toISOString(), cliente: state.clientes[$('#selCliente').value].nombre,
        items: JSON.parse(JSON.stringify(state.carrito)),
        subtotal: sub, iva, total: sub+iva, nota: $('#nota').value
      };
      state.ventas.push(venta);
      state.carrito = [];
      saveAll();
      alert('Venta confirmada. Folio '+venta.folio);
      location.hash = '#/ticket?folio='+venta.folio;
    };
    renderCarrito();
  },
  inventario(){
    $('#view').innerHTML = `
      <div class="card"><b>Registrar / Editar producto</b>
        <div class="row" style="margin-top:8px">
          <div class="col-2"><input id="sku" placeholder="SKU"></div>
          <div class="col-3"><input id="nombre" placeholder="Nombre"></div>
          <div class="col-2"><input id="cat" placeholder="Categor√≠a"></div>
          <div class="col-2"><input id="precio" type="number" placeholder="Precio"></div>
          <div class="col-1"><input id="costo" type="number" placeholder="Costo"></div>
          <div class="col-1"><input id="stock" type="number" placeholder="Stock"></div>
          <div class="col-1"><button id="guardar" class="btn btn-red" style="width:100%">Guardar</button></div>
        </div>
      </div>
      <div class="card"><b>Listado</b>
        <table class="table"><thead><tr>
          <th>SKU</th><th>Nombre</th><th>Categor√≠a</th><th>Precio</th><th>Stock</th><th></th></tr></thead><tbody id="tbProd"></tbody></table>
      </div>`;
    const tb = $('#tbProd');
    function render(){
      tb.innerHTML = state.inventario.map((p,i)=>`<tr>
        <td>${p.sku}</td><td>${p.nombre}</td><td>${p.categoria}</td><td>${fmt(p.precio)}</td><td>${p.stock}</td>
        <td class="actions"><button data-i="${i}" class="btn btn-ghost">Editar</button>
            <button data-d="${i}" class="btn btn-ghost">Borrar</button></td></tr>`).join('');
      tb.querySelectorAll('[data-i]').forEach(b=>b.onclick=()=>{
        const p = state.inventario[b.dataset.i];
        $('#sku').value=p.sku; $('#nombre').value=p.nombre; $('#cat').value=p.categoria;
        $('#precio').value=p.precio; $('#costo').value=p.costo; $('#stock').value=p.stock;
      });
      tb.querySelectorAll('[data-d]').forEach(b=>b.onclick=()=>{
        if(confirm('¬øBorrar producto?')){ state.inventario.splice(b.dataset.d,1); saveAll(); render(); }
      });
    }
    $('#guardar').onclick = ()=>{
      const p = {sku:$('#sku').value.trim(), nombre:$('#nombre').value.trim(), categoria:$('#cat').value.trim(),
                 precio:+$('#precio').value||0, costo:+$('#costo').value||0, stock:+$('#stock').value||0};
      if(!p.sku||!p.nombre) return alert('SKU y Nombre requeridos');
      const ex = state.inventario.findIndex(x=>x.sku===p.sku);
      if(ex>=0) state.inventario[ex]=p; else state.inventario.push(p);
      saveAll(); render(); $('#sku').value=$('#nombre').value=$('#cat').value=$('#precio').value=$('#costo').value=$('#stock').value='';
    };
    render();
  },
  clientes(){
    $('#view').innerHTML = `
      <div class="card"><b>Cliente</b>
        <div class="row" style="margin-top:8px">
          <div class="col-4"><input id="cNombre" placeholder="Nombre"></div>
          <div class="col-4"><input id="cTel" placeholder="Tel√©fono"></div>
          <div class="col-4"><input id="cMail" placeholder="Email"></div>
        </div>
        <div class="row">
          <div class="col-6"><label><input type="checkbox" id="cCert"> Certificado m√©dico</label></div>
          <div class="col-6"><label><input type="checkbox" id="cSolo"> Entrena por su cuenta</label></div>
        </div>
        <div class="actions"><button id="cGuardar" class="btn btn-red">Guardar / Actualizar</button></div>
      </div>
      <div class="card"><b>Listado</b>
        <table class="table"><thead><tr><th>Nombre</th><th>Tel</th><th>Email</th><th>Certif.</th><th>Solo</th><th></th></tr></thead>
        <tbody id="tbCli"></tbody></table>
      </div>`;
    const tb = $('#tbCli');
    function render(){
      tb.innerHTML = state.clientes.map((c,i)=>`<tr>
        <td>${c.nombre}</td><td>${c.tel||''}</td><td>${c.email||''}</td>
        <td>${c.cert?'S√≠':'No'}</td><td>${c.solo?'S√≠':'No'}</td>
        <td class="actions"><button data-i="${i}" class="btn btn-ghost">Editar</button>
            ${i===0?'':`<button data-d="${i}" class="btn btn-ghost">Borrar</button>`}</td></tr>`).join('');
      tb.querySelectorAll('[data-i]').forEach(b=>b.onclick=()=>{
        const c = state.clientes[b.dataset.i];
        $('#cNombre').value=c.nombre; $('#cTel').value=c.tel||''; $('#cMail').value=c.email||'';
        $('#cCert').checked=!!c.cert; $('#cSolo').checked=!!c.solo;
      });
      tb.querySelectorAll('[data-d]').forEach(b=>b.onclick=()=>{
        if(confirm('¬øBorrar cliente?')){ state.clientes.splice(b.dataset.d,1); saveAll(); render(); }
      });
    }
    $('#cGuardar').onclick = ()=>{
      const c = {nombre:$('#cNombre').value.trim(), tel:$('#cTel').value.trim(), email:$('#cMail').value.trim(),
                 cert:$('#cCert').checked, solo:$('#cSolo').checked};
      if(!c.nombre) return alert('Nombre requerido');
      const idx = state.clientes.findIndex(x=>x.nombre.toLowerCase()===c.nombre.toLowerCase());
      if(idx>=0) state.clientes[idx]=c; else state.clientes.push(c);
      saveAll(); render(); $('#cNombre').value=$('#cTel').value=$('#cMail').value=''; $('#cCert').checked=$('#cSolo').checked=false;
    };
    render();
  },
  historial(){
    $('#view').innerHTML = `
      <div class="card"><b>Ventas</b>
        <table class="table"><thead><tr><th>Folio</th><th>Fecha</th><th>Cliente</th><th>Total</th><th></th></tr></thead>
          <tbody id="tbVentas"></tbody></table>
      </div>`;
    const tb = $('#tbVentas');
    function render(){
      tb.innerHTML = state.ventas.map((v,i)=>`<tr>
        <td>${v.folio}</td><td>${new Date(v.fecha).toLocaleString('es-MX',{hour12:false})}</td><td>${v.cliente}</td><td>${fmt(v.total)}</td>
        <td class="actions"><button data-p="${v.folio}" class="btn btn-ghost">Reimprimir</button>
            <button data-d="${i}" class="btn btn-ghost">Borrar</button></td></tr>`).join('');
      tb.querySelectorAll('[data-p]').forEach(b=>b.onclick=()=>location.hash='#/ticket?folio='+b.dataset.p);
      tb.querySelectorAll('[data-d]').forEach(b=>b.onclick=()=>{
        if(!confirm('¬øBorrar venta y regresar stock?')) return;
        const v = state.ventas[b.dataset.d];
        // regresar stock
        for(const it of v.items){
          const p = state.inventario.find(x=>x.sku===it.sku);
          if(p) p.stock += it.cant;
        }
        state.ventas.splice(b.dataset.d,1);
        saveAll(); render();
      });
    }
    render();
  },
  ticket(){
    const params = Object.fromEntries(new URLSearchParams(location.hash.split('?')[1]||''));
    const venta = state.ventas.find(v=>v.folio===params.folio) || state.ventas[state.ventas.length-1];
    if(!venta){ $('#view').innerHTML = '<div class="card">Sin ventas todav√≠a.</div>'; return; }
    const lines = [];
    venta.items.forEach(it=>{ lines.push(`${it.cant}x ${it.nombre}\n${fmt(it.precio*it.cant)}`); });
    $('#view').innerHTML = `
      <div class="card" style="display:grid;place-items:center">
        <div class="ticket">
          ${state.config.logo?`<img src="${state.config.logo}" style="max-width:100%;display:block;margin:0 auto 6px">`:''}
          <h3>${state.config.negocio}</h3>
          <pre>
Ticket de venta
Folio: ${venta.folio}
Fecha: ${new Date(venta.fecha).toLocaleString('es-MX',{hour12:false})}
Cliente: ${venta.cliente}
------------------------------
${venta.items.map(it=>`${it.cant}x ${it.nombre}` ).join('\n')}
${venta.items.map(it=>`${fmt(it.precio*it.cant)}` ).join('\n')}
------------------------------
SUBTOTAL        ${fmt(venta.subtotal)}
IVA (${state.config.iva||0}%)      ${fmt(venta.iva)}
TOTAL           ${fmt(venta.total)}
${venta.nota||state.config.mensaje}
          </pre>
        </div>
        <div class="actions no-print" style="margin-top:10px">
          <button class="btn btn-red" onclick="window.print()">üñ®Ô∏è Imprimir</button>
        </div>
      </div>`;
  },
  config(){
    $('#view').innerHTML = `
      <div class="card"><b>Configuraci√≥n</b>
        <div class="row" style="margin-top:8px">
          <div class="col-4"><label class="small">IVA (%)</label><input id="cfgIva" type="number" value="${state.config.iva}"></div>
          <div class="col-8"><label class="small">Mensaje del ticket</label><input id="cfgMsg" value="${state.config.mensaje}"></div>
        </div>
        <div class="row">
          <div class="col-6"><label class="small">Nombre del negocio</label><input id="cfgNeg" value="${state.config.negocio}"></div>
          <div class="col-6"><label class="small">Logo (local, se guarda en base64)</label><input id="cfgLogo" type="file" accept="image/*"></div>
        </div>
        <div class="actions" style="margin-top:10px"><button id="cfgSave" class="btn btn-red">Guardar</button></div>
      </div>`;
    $('#cfgLogo').onchange = e=>{
      const f = e.target.files[0]; if(!f) return;
      const rd = new FileReader();
      rd.onload = ()=>{ state.config.logo = rd.result; saveAll(); alert('Logo guardado'); };
      rd.readAsDataURL(f);
    };
    $('#cfgSave').onclick = ()=>{
      state.config.iva = +$('#cfgIva').value||0;
      state.config.mensaje = $('#cfgMsg').value;
      state.config.negocio = $('#cfgNeg').value||'DINAMITA GYM POS';
      saveAll(); alert('Configuraci√≥n guardada');
    };
  }
};
/* ====== EXPORT ====== */
function exportCSV(){
  const ventas = state.ventas;
  const head = ['Folio','Fecha','Cliente','Items','Subtotal','IVA','Total'];
  const rows = ventas.map(v=>[
    v.folio, new Date(v.fecha).toLocaleString('es-MX',{hour12:false}), v.cliente,
    v.items.map(i=>`${i.cant}x ${i.nombre}`).join(' | '), v.subtotal, v.iva, v.total
  ]);
  const csv = [head, ...rows].map(r=>r.map(x=>('"'+String(x).replace(/"/g,'""')+'"')).join(',')).join('\n');
  const blob = new Blob([csv], {type:'text/csv;charset=utf-8;'});
  const a = document.createElement('a'); a.href = URL.createObjectURL(blob); a.download = 'ventas.csv'; a.click();
}
function exportPDF(){
  if(!state.ventas.length){ alert('No hay ventas'); return; }
  const w = window.open('', '_blank');
  const desde = ''; // simple ‚Äì puedes ampliar con filtros por fecha
  const html = `<!doctype html><html><head><meta charset="utf-8"><title>Ventas</title>
    <style>body{font-family:Arial,Helvetica,sans-serif;padding:20px} h2{margin:0 0 6px 0}
    table{width:100%;border-collapse:collapse} td,th{border:1px solid #ddd;padding:6px;font-size:12px}
    .right{text-align:right}</style></head><body>
    <h2>${state.config.negocio} ¬∑ Reporte de ventas</h2>
    <div>Generado: ${nowStr()}</div>
    <table><thead><tr><th>Folio</th><th>Fecha</th><th>Cliente</th><th>Items</th><th class="right">Subtotal</th><th class="right">IVA</th><th class="right">Total</th></tr></thead>
    <tbody>${
      state.ventas.map(v=>`<tr>
        <td>${v.folio}</td><td>${new Date(v.fecha).toLocaleString('es-MX',{hour12:false})}</td>
        <td>${v.cliente}</td><td>${v.items.map(i=>`${i.cant}x ${i.nombre}`).join(' ¬∑ ')}</td>
        <td class="right">${fmt(v.subtotal)}</td><td class="right">${fmt(v.iva)}</td><td class="right">${fmt(v.total)}</td>
      </tr>`).join('')
    }</tbody></table>
    <script>window.onload=()=>{window.print();}</script>
  </body></html>`;
  w.document.write(html); w.document.close();
}
/* ====== ROUTER ====== */
function render(){
  const hash = location.hash.split('?')[0] || '#/dashboard';
  const page = hash.replace('#/','');
  $$('#menu a').forEach(a=>a.classList.toggle('active', a.dataset.route===page));
  (routes[page]||routes.dashboard)();
}
window.addEventListener('hashchange', render);
render();
/* Footer buttons */
$('#btnCsv').onclick = exportCSV;
$('#btnPdf').onclick = exportPDF;
</script>
</body>
</html>
